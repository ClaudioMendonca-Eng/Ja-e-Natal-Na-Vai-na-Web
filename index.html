<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Gerador de Cart√£o de Natal Personalizado por Claudio Mendon√ßa"
    />
    <title>Feliz Natal - Uma Mensagem Especial</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:wght@700;900&family=Cinzel:wght@400;700&display=swap");

      :root {
        /* Cores Padr√£o (ser√£o alteradas via JS) */
        --primary: #d42426;
        --secondary: #f2d492;
        --bg-color: #0f172a;
        --text-color: #ffffff;
        --font-main: "Poppins", sans-serif;
        --font-title: "Playfair Display", serif;
      }

      /* Classes de Acessibilidade */
      .high-contrast {
        --primary: #ffff00 !important;
        --secondary: #00ffff !important;
        --bg-color: #000000 !important;
        --text-color: #ffffff !important;
      }

      .large-font {
        font-size: 1.2em;
      }

      .large-font h1 {
        font-size: 4.8rem !important;
      }

      .large-font .recipient-name {
        font-size: 5.4rem !important;
      }

      .large-font p,
      .large-font .message-text {
        font-size: 1.5rem !important;
      }

      .large-font label {
        font-size: 1.1rem !important;
      }

      .large-font input,
      .large-font select {
        font-size: 1.15rem !important;
      }

      .large-font button {
        font-size: 1.3rem !important;
      }

      .large-font .footer-sig {
        font-size: 1.2rem !important;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        background: radial-gradient(ellipse at bottom, var(--bg-color) 0%, #000 100%);
        color: var(--text-color);
        font-family: var(--font-main);
        overflow-x: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        transition: background 1s ease;
      }

      /* Efeito de fundo animado */
      body::before {
        content: '';
        position: fixed;
        width: 200%;
        height: 200%;
        top: -50%;
        left: -50%;
        z-index: 0;
        background: linear-gradient(45deg, transparent 30%, var(--primary) 30%, var(--primary) 70%, transparent 70%);
        opacity: 0.03;
        animation: bg-slide 20s linear infinite;
      }

      @keyframes bg-slide {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Bot√µes de Acessibilidade */
      #a11y-controls {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        display: flex;
        gap: 12px;
      }

      .a11y-btn {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      .a11y-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-3px) scale(1.1);
        box-shadow: 0 12px 40px rgba(255, 255, 255, 0.3);
      }

      /* Container Principal */
      #app-container {
        text-align: center;
        position: relative;
        z-index: 10;
        width: 100%;
        max-width: 650px;
        padding: 20px;
      }

      /* Tela de Entrada */
      #input-screen {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        padding: 50px 40px;
        border-radius: 32px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        animation: fadeInUp 0.8s ease;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(40px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        font-family: var(--font-title);
        font-size: 4rem;
        font-weight: 900;
        color: var(--secondary);
        text-shadow: 0 4px 20px rgba(255, 255, 255, 0.4);
        margin-bottom: 10px;
        line-height: 1.1;
        letter-spacing: 2px;
        animation: glow 2s ease-in-out infinite alternate;
      }

      @keyframes glow {
        from {
          text-shadow: 0 4px 20px rgba(255, 255, 255, 0.3);
        }
        to {
          text-shadow: 0 4px 30px rgba(255, 255, 255, 0.6), 0 0 40px var(--primary);
        }
      }

      #input-screen p {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1.1rem;
        margin-bottom: 35px;
        font-weight: 300;
      }

      label {
        display: block;
        margin-top: 25px;
        margin-bottom: 8px;
        font-weight: 600;
        text-align: left;
        font-size: 0.95rem;
        color: rgba(255, 255, 255, 0.9);
        letter-spacing: 0.5px;
      }

      input,
      select {
        width: 100%;
        padding: 16px 24px;
        border-radius: 16px;
        border: 2px solid rgba(255, 255, 255, 0.15);
        font-size: 1rem;
        font-family: var(--font-main);
        margin-bottom: 10px;
        outline: none;
        background: rgba(255, 255, 255, 0.95);
        color: #1a1a1a;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      input:focus,
      select:focus {
        border-color: var(--secondary);
        background: #ffffff;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2), 0 0 0 4px rgba(242, 212, 146, 0.2);
      }

      select {
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 20px center;
        padding-right: 45px;
      }

      button.primary-btn {
        background: linear-gradient(135deg, var(--primary) 0%, #8b0000 100%);
        color: white;
        border: none;
        padding: 18px 50px;
        border-radius: 50px;
        font-size: 1.2rem;
        font-weight: 700;
        cursor: pointer;
        margin-top: 30px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 10px 30px rgba(212, 36, 38, 0.4);
        letter-spacing: 1px;
        text-transform: uppercase;
        position: relative;
        overflow: hidden;
      }

      button.primary-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
      }

      button.primary-btn:hover::before {
        left: 100%;
      }

      button.primary-btn:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 15px 40px rgba(212, 36, 38, 0.6);
      }

      button.primary-btn:active {
        transform: translateY(-1px) scale(1.02);
      }

      /* Tela do Cart√£o */
      #card-screen {
        display: none;
        opacity: 0;
        transition: opacity 1s ease;
      }

      .message-box {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        padding: 50px;
        border-radius: 28px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 25px;
        position: relative;
        box-shadow: 0 25px 70px rgba(0, 0, 0, 0.7), 
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
        animation: cardReveal 1s ease;
      }

      @keyframes cardReveal {
        from {
          opacity: 0;
          transform: scale(0.9) rotateX(10deg);
        }
        to {
          opacity: 1;
          transform: scale(1) rotateX(0deg);
        }
      }

      .message-text {
        font-size: 1.4rem;
        line-height: 2;
        margin-bottom: 35px;
        font-style: italic;
        font-weight: 300;
        color: rgba(255, 255, 255, 0.95);
      }

      .recipient-name {
        font-family: var(--font-title);
        font-size: 4.5rem;
        font-weight: 900;
        color: var(--primary);
        display: block;
        margin-bottom: 25px;
        text-shadow: 0 4px 15px rgba(212, 36, 38, 0.5);
        letter-spacing: 2px;
        animation: nameShine 3s ease-in-out infinite;
      }

      @keyframes nameShine {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.8; text-shadow: 0 4px 25px var(--primary); }
      }

      .footer-sig {
        margin-top: 25px;
        font-size: 1.05rem;
        opacity: 0.85;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        padding-top: 20px;
        font-family: "Cinzel", serif;
        font-weight: 600;
      }

      /* Efeito de Neve / Part√≠culas */
      .particle {
        position: fixed;
        top: -10px;
        color: white;
        font-size: 1em;
        animation: fall linear forwards;
        z-index: 1;
        pointer-events: none;
        filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
      }

      @keyframes fall {
        to {
          transform: translateY(105vh) rotate(360deg);
          opacity: 0;
        }
      }

      /* Bot√£o Secund√°rio */
      .action-btn {
        background: linear-gradient(135deg, var(--secondary) 0%, #d4a02c 100%);
        color: #1a1a1a;
        font-weight: 700;
        font-size: 1.05rem;
        padding: 15px 35px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        margin: 8px;
        transition: all 0.3s ease;
        box-shadow: 0 8px 25px rgba(242, 212, 146, 0.3);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .action-btn:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 12px 35px rgba(242, 212, 146, 0.5);
      }

      .action-btn.secondary {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.4);
        color: white;
      }

      .action-btn.secondary:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.6);
      }

      /* Canvas escondido para gerar imagem */
      #downloadCanvas {
        display: none;
      }

      /* Footer */
      footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        padding: 8px;
        text-align: center;
        z-index: 999;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      footer a {
        color: var(--secondary);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.8rem;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      footer a:hover {
        color: #ffffff;
        text-shadow: 0 0 10px var(--secondary);
        transform: scale(1.05);
      }

      /* Responsivo */
      @media (max-width: 600px) {
        h1 {
          font-size: 3rem;
        }
        .recipient-name {
          font-size: 3rem;
        }
        #input-screen {
          padding: 35px 25px;
        }
        .message-box {
          padding: 35px 25px;
        }
      }
    </style>
  </head>
  <body>
    <div id="a11y-controls">
      <button
        class="a11y-btn"
        onclick="toggleContrast()"
        aria-label="Alto Contraste"
      >
        ‚óê
      </button>
      <button
        class="a11y-btn"
        onclick="toggleFontSize()"
        aria-label="Aumentar Fonte"
      >
        A+
      </button>
    </div>

    <audio id="bgMusic" loop>
      <source id="audioSource" src="" type="audio/mp3" />
    </audio>

    <div id="app-container">
      <div id="input-screen" role="form" aria-labelledby="formTitle">
        <img src="https://raw.githubusercontent.com/ClaudioMendonca-Eng/VaiNaWeb-FormacaoEmCybersecurity-Modulo01/main/doc/img/logos.png" alt="Logos" style="max-width: 100%; height: auto; margin-bottom: 20px; border-radius: 12px;">
        <h1 id="formTitle">Magia de Natal</h1>
        <p>Vamos criar algo √∫nico para voc√™.</p>

        <label for="nameInput">Qual o seu nome?</label>
        <input
          type="text"
          id="nameInput"
          placeholder="Digite seu nome..."
          autocomplete="off"
        />

        <label for="themeSelect"
          >Como voc√™ sente o esp√≠rito natalino hoje?</label
        >
        <select id="themeSelect">
          <option value="alegre">üéÑ Alegre e Festivo</option>
          <option value="gotico">ü¶á G√≥tico e Misterioso</option>
          <option value="espiritual">‚ú® Espiritual e C√≥smico</option>
          <option value="religioso">üôè Religioso e Sagrado</option>
          <option value="reflexivo">üìñ Reflexivo e Silencioso</option>
        </select>

        <label for="elementSelect">Escolha um s√≠mbolo visual:</label>
        <select id="elementSelect">
          <option value="luzes">Luzes e Brilho</option>
          <option value="natureza">Natureza (Neve/Folhas)</option>
          <option value="simbolos">S√≠mbolos Abstratos</option>
        </select>

        <br />
        <button class="primary-btn" onclick="revealCard()">
          Revelar Presente
        </button>
      </div>

      <div id="card-screen" aria-live="polite">
        <div class="message-box" id="cardContent">
          <img src="https://raw.githubusercontent.com/ClaudioMendonca-Eng/VaiNaWeb-FormacaoEmCybersecurity-Modulo01/main/doc/img/logos.png" alt="Logos" style="max-width: 100%; height: auto; margin-bottom: 20px; border-radius: 12px;">
          <span class="recipient-name" id="displayName">Nome</span>
          <p class="message-text" id="displayMessage">Carregando mensagem...</p>
          <div class="footer-sig">
            Recebido pela <strong>Comunidade Vai Na WEB!!</strong>.
          </div>
        </div>

        <button class="action-btn" onclick="downloadCard()">
          üì• Baixar Cart√£o Personalizado
        </button>
        <button class="action-btn secondary" onclick="location.reload()">
          ‚Ü∫ Reiniciar
        </button>
      </div>
    </div>

    <canvas id="downloadCanvas" width="1080" height="1080"></canvas>

    <script>
      // --- CONFIGURA√á√ÉO DE TEMAS E CONTE√öDO ---

      const themesData = {
        alegre: {
          colors: { primary: "#d42426", secondary: "#f2d492", bg: "#165b33" },
          font: "'Great Vibes', cursive",
          particle: "‚ùÑ", // Neve
          music:
            "https://cdn.pixabay.com/download/audio/2022/11/22/audio_febc508520.mp3", // Upbeat Christmas
          messages: [
            "Que a alegria deste Natal balance sua vida como os sinos de uma can√ß√£o feliz!",
            "Sorrisos, abra√ßos e muita luz! Que seu Natal seja t√£o vibrante quanto sua energia.",
            "Ho Ho Ho! Que a magia do Natal transforme cada pequeno momento em uma grande festa.",
          ],
        },
        gotico: {
          colors: { primary: "#800020", secondary: "#C0C0C0", bg: "#000000" }, // Vinho, Prata, Preto
          font: "'Cinzel', serif",
          particle: "ü¶á", // Morcego ou folha seca
          music:
            "https://cdn.pixabay.com/download/audio/2022/01/18/audio_d0a13f69d2.mp3", // Dark Piano/Mystery
          messages: [
            "Na noite mais longa, que a chama do seu esp√≠rito arda mais forte que o inverno.",
            "Beleza e mist√©rio se encontram sob o visco. Um Natal de sombras e encantos para voc√™.",
            "Que a eleg√¢ncia da escurid√£o traga o conforto silencioso que s√≥ a alma compreende.",
          ],
        },
        espiritual: {
          colors: { primary: "#9d4edd", secondary: "#e0aaff", bg: "#10002b" }, // Roxo e Lilas
          font: "'Montserrat', sans-serif",
          particle: "‚ú®", // Brilho
          music:
            "https://cdn.pixabay.com/download/audio/2021/09/06/audio_9593006830.mp3", // Ambient Ethereal
          messages: [
            "Que o universo conspire para trazer luz, energia e renova√ß√£o ao seu ciclo solar.",
            "Como as estrelas guiam a noite, que sua intui√ß√£o guie seu novo ano. Luz e Paz.",
            "Conecte-se com a magia ancestral desta data. Voc√™ √© parte do milagre da exist√™ncia.",
          ],
        },
        religioso: {
          colors: { primary: "#daa520", secondary: "#ffffff", bg: "#3e2723" }, // Dourado e Marrom/Branco
          font: "'Great Vibes', cursive",
          particle: "‚úù", // Cruz ou Anjo
          music:
            "https://cdn.pixabay.com/download/audio/2022/12/16/audio_0346e29b12.mp3", // Choir/Orchestral
          messages: [
            "Que a b√™n√ß√£o do menino Jesus renas√ßa em seu cora√ß√£o trazendo f√© e esperan√ßa.",
            "Gl√≥ria e paz! Que a luz divina ilumine sua casa e proteja sua fam√≠lia neste Natal.",
            "O verdadeiro presente √© o amor de Deus. Que ele transborde em sua vida.",
          ],
        },
        reflexivo: {
          colors: { primary: "#607d8b", secondary: "#eceff1", bg: "#263238" }, // Tons de cinza e azul
          font: "'Montserrat', sans-serif",
          particle: "üçÇ",
          music:
            "https://cdn.pixabay.com/download/audio/2021/11/25/audio_91b7d56036.mp3", // Acoustic Guitar/Soft
          messages: [
            "No sil√™ncio desta noite, que voc√™ encontre as respostas que seu cora√ß√£o procura.",
            "Natal √© tempo de pausar, respirar e agradecer pela jornada at√© aqui.",
            "Que a serenidade seja seu maior presente e a sabedoria sua melhor companhia.",
          ],
        },
      };

      // Estado Global
      let currentTheme = "alegre";
      let currentElement = "luzes";
      let currentName = "";
      let currentMessage = "";

      // --- FUN√á√ïES DE ACESSIBILIDADE ---
      function toggleContrast() {
        document.body.classList.toggle("high-contrast");
      }

      function toggleFontSize() {
        document.body.classList.toggle("large-font");
      }

      // --- L√ìGICA DO APP ---

      function createParticle(char) {
        const particle = document.createElement("div");
        particle.classList.add("particle");
        particle.innerText = char;
        particle.style.left = Math.random() * 100 + "vw";
        particle.style.animationDuration = Math.random() * 3 + 3 + "s";
        particle.style.opacity = Math.random();
        particle.style.fontSize = Math.random() * 20 + 10 + "px";
        document.body.appendChild(particle);

        setTimeout(() => {
          particle.remove();
        }, 6000);
      }

      function revealCard() {
        const name = document.getElementById("nameInput").value.trim();
        const themeKey = document.getElementById("themeSelect").value;
        const elementKey = document.getElementById("elementSelect").value;

        if (!name) {
          alert("Por favor, precisamos do seu nome para a m√°gica acontecer!");
          return;
        }

        // Salvar estado
        currentName = name;
        currentTheme = themeKey;
        currentElement = elementKey;

        const themeData = themesData[themeKey];

        // 1. Atualizar CSS Variables
        const r = document.querySelector(":root");
        r.style.setProperty("--primary", themeData.colors.primary);
        r.style.setProperty("--secondary", themeData.colors.secondary);
        r.style.setProperty("--bg-color", themeData.colors.bg);
        r.style.setProperty("--font-title", themeData.font);

        // 2. Definir Mensagem
        const msgs = themeData.messages;
        currentMessage = msgs[Math.floor(Math.random() * msgs.length)];

        // 3. Atualizar DOM
        document.getElementById("displayName").innerText = currentName;
        document.getElementById("displayMessage").innerText = currentMessage;

        // 4. √Åudio
        const audio = document.getElementById("bgMusic");
        audio.src = themeData.music;
        audio.volume = 0.3;
        audio
          .play()
          .catch((e) => console.log("√Åudio precisa de intera√ß√£o pr√©via"));

        // 5. Transi√ß√£o visual
        document.getElementById("input-screen").style.opacity = "0";
        setTimeout(() => {
          document.getElementById("input-screen").style.display = "none";
          const cardScreen = document.getElementById("card-screen");
          cardScreen.style.display = "block";
          setTimeout(() => (cardScreen.style.opacity = "1"), 50);

          // Iniciar part√≠culas do tema
          setInterval(() => createParticle(themeData.particle), 200);
        }, 500);
      }

      // --- GERA√á√ÉO DE IMAGEM (CANVAS) ---

      function downloadCard() {
        const canvas = document.getElementById("downloadCanvas");
        const ctx = canvas.getContext("2d");
        const theme = themesData[currentTheme];

        // Carregar imagem
        const logo = new Image();
        logo.crossOrigin = "anonymous";
        logo.onload = function() {
          // Reset
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          // 1. Fundo Din√¢mico
          const grd = ctx.createLinearGradient(0, 0, 0, 1080);
          grd.addColorStop(0, theme.colors.bg);
          grd.addColorStop(1, adjustColor(theme.colors.bg, -40)); // Escurecer um pouco embaixo
          ctx.fillStyle = grd;
          ctx.fillRect(0, 0, 1080, 1080);

          // 2. Elementos Visuais Decorativos (Baseado na escolha Elemento + Tema)
          drawDecorations(ctx, theme.colors.secondary, theme.particle);

          // 3. Moldura
          ctx.strokeStyle = theme.colors.secondary;
          ctx.lineWidth = 25;
          ctx.strokeRect(50, 50, 980, 980);

          // Detalhe cantos da moldura
          ctx.fillStyle = theme.colors.primary;
          ctx.fillRect(30, 30, 80, 80); // Top Left
          ctx.fillRect(970, 30, 80, 80); // Top Right
          ctx.fillRect(30, 970, 80, 80); // Bottom Left
          ctx.fillRect(970, 970, 80, 80); // Bottom Right

          // 3.5. Desenhar logo no topo
          const logoWidth = 600;
          const logoHeight = (logo.height / logo.width) * logoWidth;
          ctx.drawImage(logo, (1080 - logoWidth) / 2, 120, logoWidth, logoHeight);

          // 4. Texto: Nome (com ajuste autom√°tico de tamanho)
          ctx.fillStyle = theme.colors.primary;
          const fontName = currentTheme === "gotico" ? "serif" : "cursive";
          let fontSize = 130;
          ctx.font = `bold ${fontSize}px ${fontName}`;
          
          // Ajustar tamanho da fonte se o nome for muito grande
          const maxWidth = 880; // Largura m√°xima dentro da moldura
          let textWidth = ctx.measureText(currentName).width;
          
          while (textWidth > maxWidth && fontSize > 40) {
            fontSize -= 5;
            ctx.font = `bold ${fontSize}px ${fontName}`;
            textWidth = ctx.measureText(currentName).width;
          }
          
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.shadowColor = "rgba(0,0,0,0.5)";
          ctx.shadowBlur = 10;
          ctx.fillText(currentName, 540, 380 + logoHeight);
          ctx.shadowBlur = 0; // Reset shadow

          // 5. Texto: Mensagem
          ctx.fillStyle = "#ffffff";
          ctx.font = "50px sans-serif";
          // Adicionar aspas decorativas
          ctx.fillText("‚ùù", 540, 520 + logoHeight);
          wrapText(ctx, currentMessage, 540, 590 + logoHeight, 800, 75);

          // 6. Rodap√© Comunidade Vai Na WEB
          ctx.fillStyle = theme.colors.secondary;
          ctx.font = "italic 40px serif";
          ctx.fillText("Recebido pela Comunidade Vai Na WEB!!!", 540, 940);

          // Baixar
          const link = document.createElement("a");
          link.download = `Presente_${currentName}_${currentTheme}.png`;
          link.href = canvas.toDataURL();
          link.click();
        };
        
        logo.onerror = function() {
          // Se a imagem falhar, continuar sem ela
          console.error("Erro ao carregar a imagem do logo");
          renderCardWithoutLogo();
        };
        
        logo.src = "https://raw.githubusercontent.com/ClaudioMendonca-Eng/VaiNaWeb-FormacaoEmCybersecurity-Modulo01/main/doc/img/logos.png";
      }

      // Fun√ß√£o auxiliar para renderizar sem logo (fallback)
      function renderCardWithoutLogo() {
        const canvas = document.getElementById("downloadCanvas");
        const ctx = canvas.getContext("2d");
        const theme = themesData[currentTheme];

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const grd = ctx.createLinearGradient(0, 0, 0, 1080);
        grd.addColorStop(0, theme.colors.bg);
        grd.addColorStop(1, adjustColor(theme.colors.bg, -40));
        ctx.fillStyle = grd;
        ctx.fillRect(0, 0, 1080, 1080);

        drawDecorations(ctx, theme.colors.secondary, theme.particle);

        ctx.strokeStyle = theme.colors.secondary;
        ctx.lineWidth = 25;
        ctx.strokeRect(50, 50, 980, 980);

        ctx.fillStyle = theme.colors.primary;
        ctx.fillRect(30, 30, 80, 80);
        ctx.fillRect(970, 30, 80, 80);
        ctx.fillRect(30, 970, 80, 80);
        ctx.fillRect(970, 970, 80, 80);

        ctx.fillStyle = theme.colors.primary;
        const fontName = currentTheme === "gotico" ? "serif" : "cursive";
        let fontSize = 130;
        ctx.font = `bold ${fontSize}px ${fontName}`;
        
        const maxWidth = 880;
        let textWidth = ctx.measureText(currentName).width;
        
        while (textWidth > maxWidth && fontSize > 40) {
          fontSize -= 5;
          ctx.font = `bold ${fontSize}px ${fontName}`;
          textWidth = ctx.measureText(currentName).width;
        }
        
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.shadowColor = "rgba(0,0,0,0.5)";
        ctx.shadowBlur = 10;
        ctx.fillText(currentName, 540, 350);
        ctx.shadowBlur = 0;

        ctx.fillStyle = "#ffffff";
        ctx.font = "50px sans-serif";
        ctx.fillText("‚ùù", 540, 480);
        wrapText(ctx, currentMessage, 540, 550, 800, 75);

        ctx.fillStyle = theme.colors.secondary;
        ctx.font = "italic 40px serif";
        ctx.fillText("Recebido pela Comunidade Vai Na WEB!!!", 540, 920);

        const link = document.createElement("a");
        link.download = `Presente_${currentName}_${currentTheme}.png`;
        link.href = canvas.toDataURL();
        link.click();
      }

      // Fun√ß√£o para desenhar decora√ß√µes baseadas no estilo
      function drawDecorations(ctx, color, char) {
        ctx.fillStyle = color;
        ctx.globalAlpha = 0.2;

        if (currentElement === "simbolos") {
          // Desenhar simbolos grandes de fundo
          ctx.font = "300px serif";
          ctx.fillText(char, 200, 200);
          ctx.fillText(char, 880, 880);
        } else if (currentElement === "natureza") {
          // Desenhar "folhagens" ou neve nas bordas
          for (let i = 0; i < 50; i++) {
            ctx.beginPath();
            ctx.arc(
              Math.random() * 1080,
              Math.random() * 200,
              Math.random() * 5,
              0,
              2 * Math.PI
            );
            ctx.fill(); // Neve topo
            ctx.beginPath();
            ctx.arc(
              Math.random() * 1080,
              880 + Math.random() * 200,
              Math.random() * 5,
              0,
              2 * Math.PI
            );
            ctx.fill(); // Neve base
          }
        } else {
          // Luzes
          for (let i = 0; i < 20; i++) {
            ctx.beginPath();
            ctx.arc(
              Math.random() * 1080,
              Math.random() * 1080,
              Math.random() * 30,
              0,
              2 * Math.PI
            );
            ctx.fill();
          }
        }
        ctx.globalAlpha = 1.0;
      }

      // Auxiliar: Quebra de texto
      function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
        const words = text.split(" ");
        let line = "";
        for (let n = 0; n < words.length; n++) {
          const testLine = line + words[n] + " ";
          const metrics = ctx.measureText(testLine);
          if (metrics.width > maxWidth && n > 0) {
            ctx.fillText(line, x, y);
            line = words[n] + " ";
            y += lineHeight;
          } else {
            line = testLine;
          }
        }
        ctx.fillText(line, x, y);
      }

      // Auxiliar: Escurecer cor Hex
      function adjustColor(color, amount) {
        return (
          "#" +
          color
            .replace(/^#/, "")
            .replace(/../g, (color) =>
              (
                "0" +
                Math.min(
                  255,
                  Math.max(0, parseInt(color, 16) + amount)
                ).toString(16)
              ).substr(-2)
            )
        );
      }
    </script>

    <footer>
      <a href="https://claudiomendonca.eng.br/" target="_blank" rel="noopener noreferrer">
        ‚ú® Desenvolvido por Claudio Mendon√ßa
      </a>
    </footer>
  </body>
</html>
